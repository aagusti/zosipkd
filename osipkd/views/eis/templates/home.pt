<html metal:use-macro="load: base.pt">
    <div metal:fill-slot="content">
        <script>
            $(function(){
                $('.carousel').carousel({
                    interval: 5000
                });
            });
        </script>
        <style>
            body {
                background-image: url("static/img/bg1.jpg");
            }
            .judul {
                margin-top: 10px;
                color: #777;
                font-size: 40px;
                font-weight: normal;
            }
            .subjudul {
                margin-bottom: 0px;
                margin-bottom: 20px;
                color: #777;
                font-size: 30px;
                font-weight: normal;
            }
            .alert {
                border-radius: 0px !important;
            }
            .alert-judul {
                color: #fff;
                background-color: #6497C9;
                border-color: #5580AA;
            }
            .alert-judul h3 {
                margin-top: 4px !important;
                margin-bottom: 4px !important;
            }
        </style>
        <script>
           var randomScalingFactor = function(){ return Math.round(Math.random()*100)};
        </script>
        <div class="well">
          <!--div class="judul">
              <center>
                  <p>Pendapatan Pajak Daerah</p>
                  <p class="subjudul">Tahun ${request.session['tahun']}</p>
              </center>
          </div-->
          
          <div id="myCarousel" class="carousel" data-ride="carousel">
              <!-- Indicators -->
              <ol class="carousel-indicators">
                  <li tal:repeat="dat datas" data-target="#myCarousel" data-slide-to="${dat.order_id}" class="${dat.is_aktif and 'active' or ''}"></li>
              </ol>
              
              <div class="carousel-inner" role="listbox">
                <div tal:repeat="dat datas" class="item ${dat.is_aktif and 'active' or ''}">
                    <div class="col-sm-12" style="margin-bottom:50px;" tal:condition="dat.source_type=='grid'">
                        <div class="row">
                          <center>
                            <div class="row"> <!--TITLE-->
                                <div class="col-sm-12">
                                    <div class="alert alert-judul">
                                        <h3>${dat.nama} ${dat.nama}</h3>
                                    </div>
                                </div>
                            </div>
                            <div class="row">  <!--hari minggu-->
                                <div class="col-sm-6">
                                  <div class="alert alert-success">
                                      <h4><u>Hari ini</u></h4>
                                      <h2>Rp. <span id="hari_${dat.id}">...</span></h2>
                                  </div>
                                </div>
                                <div class="col-sm-6">
                                    <div class="alert alert-info">
                                        <h4><u>Minggu ini</u></h4>
                                        <h2>Rp. <span id="minggu_${dat.id}">...</span></h2>
                                    </div>
                                </div>
                            </div>
                            <div class="row">   <!--bulan tahun-->
                              <div class="col-sm-6">
                                  <div class="alert alert-warning">
                                      <h4><u>Bulan ini</u></h4>
                                      <h2>Rp. <span id="bulan_${dat.id}">...</span></h2>
                                  </div>
                              </div>
                              <div class="col-sm-6">
                                  <div class="alert alert-danger">
                                      <h4><u>Tahun ini</u></h4>
                                      <h2>Rp. <span id="tahun_${dat.id}">...</span></h2>
                                  </div>
                              </div>
                            </div>
                          </center>
                        </div>
                        <!--SCRIPT-->
                        <script>                
                          $(function(){
                              $.ajax({
                                type: "POST",
                                url: "/eis/act/grid",
                                data: "id=${dat.source_id}",
                                success: function (html) {
                                  if (html.success == true) {
                                    $("#hari_${dat.id}").html(html.hari);
                                    $("#minggu_${dat.id}").html(html.minggu);
                                    $("#bulan_${dat.id}").html(html.bulan);
                                    $("#tahun_${dat.id}").html(html.tahun);
                                  }
                                },
                                beforeSend: function () {
                                }
                              });
                            })
                        </script>                                               
                    </div>
                    
                    <div class="col-sm-12" style="margin-bottom:20px;" tal:condition="dat.source_type=='image'">
                        <div class="row">
                            <center>
                              <div class="row">
                                  <div class="col-sm-12">
                                      <div class="alert alert-judul">
                                          <h3>${dat.nama}</h3>
                                      </div>
                                  </div>
                              </div>
                              <div class="row">
                                    <img src="${dat.source_id}" height="500px">
                              </div>
                            </center>
                        </div>
                    
                    </div>
                    <div class="col-sm-12" style="margin-bottom:50px;" tal:condition="dat.source_type=='chart-line'">
                        <div class="row">
                          <center>
                            <div class="row">
                              <div class="col-sm-12">
                                  <div class="alert alert-judul">
                                      <h3>${dat.nama}</h3>
                                  </div>
                              </div>
                            </div>
                            <div class="row">
                                 <canvas id="canvas_${dat.id}" height="450px" width="600px"></canvas>
                            </div>
                              
                          </center>
                        </div>
                        <script>
                            var lineChartData_${dat.id} = {
                              labels : [],
                              datasets : [
                                {
                                  label: "Target",
                                  fillColor : "rgba(220,220,220,0.2)",
                                  strokeColor : "rgba(220,220,220,1)",
                                  pointColor : "rgba(220,220,220,1)",
                                  pointStrokeColor : "#fff",
                                  pointHighlightFill : "#fff",
                                  pointHighlightStroke : "rgba(220,220,220,1)",
                                  data : []
                                },
                                {
                                  label: "Realisasi",
                                  fillColor : "rgba(151,187,205,0.2)",
                                  strokeColor : "rgba(151,187,205,1)",
                                  pointColor : "rgba(151,187,205,1)",
                                  pointStrokeColor : "#fff",
                                  pointHighlightFill : "#fff",
                                  pointHighlightStroke : "rgba(151,187,205,1)",
                                  data : []
                                }
                              ]

                            }
                                                        
                            $(function(){
                              var ctx_${dat.id} = document.getElementById("canvas_${dat.id}").getContext("2d");
                              window.myLine_${dat.id} = new Chart(ctx_${dat.id}).Line(lineChartData_${dat.id}, {
                                //responsive: true
                              });
                              
                              $.ajax({
                                  type: "POST",
                                  url: "/eis/act/linebar",
                                  data: "id=${dat.source_id}",
                                  success: function (html) {
                                    if (html.success == true) {
                                      for (i = 0; i < html.label.length; i++) { 
                                        window.myLine_${dat.id}.addData([html.target[i],html.realisasi[i]],html.label[i]);
                                      }
                                    }
                                  },
                                  beforeSend: function () {
                                  }
                                });
                            });
    
                          
                        
                        </script>
                    </div>
                    <div class="col-sm-12" style="margin-bottom:50px;" tal:condition="dat.source_type=='chart-bar'">
                        <div class="row">
                          <center>
                            <div class="row">
                              <div class="col-sm-12">
                                  <div class="alert alert-judul">
                                      <h3>${dat.nama}</h3>
                                  </div>
                              </div>
                            </div>
                            <div class="row">
                                 <canvas id="canvas_${dat.id}" height="450px" width="600px"></canvas>
                            </div>
                              
                          </center>
                        </div>
                        <script>
                            var barChartData_${dat.id} = {
                              labels : [],
                              datasets : [
                                {
                                  label: "Target",
                                  fillColor : "rgba(220,220,220,0.2)",
                                  strokeColor : "rgba(220,220,220,1)",
                                  pointColor : "rgba(220,220,220,1)",
                                  pointStrokeColor : "#fff",
                                  pointHighlightFill : "#fff",
                                  pointHighlightStroke : "rgba(220,220,220,1)",
                                  data : []
                                },
                                {
                                  label: "Realisasi",
                                  fillColor : "rgba(151,187,205,0.2)",
                                  strokeColor : "rgba(151,187,205,1)",
                                  pointColor : "rgba(151,187,205,1)",
                                  pointStrokeColor : "#fff",
                                  pointHighlightFill : "#fff",
                                  pointHighlightStroke : "rgba(151,187,205,1)",
                                  data : []
                                }
                              ]

                            }
                                                        
                            $(function(){
                              var ctx_${dat.id} = document.getElementById("canvas_${dat.id}").getContext("2d");
                              window.myBar_${dat.id} = new Chart(ctx_${dat.id}).Bar(barChartData_${dat.id}, {
                                //responsive: true
                              });
                              //GET DATA FROM SERVER
                              $.ajax({
                                  type: "POST",
                                  url: "/eis/act/linebar",
                                  data: "id=${dat.source_id}",
                                  success: function (html) {
                                    if (html.success == true) {
                                      for (i = 0; i < html.label.length; i++) { 
                                        window.myBar_${dat.id}.addData([html.target[i],html.realisasi[i]],html.label[i]);
                                      }
                                    }
                                  },
                                  beforeSend: function () {
                                  }
                                });
                            });
                        </script>                              
                    </div>
                    <div class="col-sm-12" style="margin-bottom:50px;" tal:condition="dat.source_type=='chart-pie'">
                        <div class="row">
                            <center>
                              <div class="row">
                                  <div class="col-sm-12">
                                      <div class="alert alert-judul">
                                          <h3>${dat.nama}</h3>
                                      </div>
                                  </div>
                              </div>
                              <div class="row">
                                   <canvas id="chart-area_${dat.id}" height="450px" width="600px"></canvas>
                              </div>
                            
                            </center>
                        </div>
                        <script>
                          var pieData_${dat.id} = [];
                          $(function(){
                            /*GET DATA PIE*/
                            var ctx_${dat.id} = document.getElementById("chart-area_${dat.id}").getContext("2d");
                            window.myPie_${dat.id} = new Chart(ctx_${dat.id}).Pie(pieData_${dat.id});
                            //GET DATA FROM SERVER
                              $.ajax({
                                  type: "POST",
                                  url: "/eis/act/pie",
                                  data: "id=${dat.source_id}",
                                  success: function (html) {
                                    if (html.success == true) {
                                      jQuery.each(html.rows, function(i, val) {
                                          myPie_${dat.id}.addData(
                                          {
                                            value: val.value,
                                            color: "#"+val.color,
                                            highlight: "#"+val.highlight,
                                            label: val.nama
                                          });
                                      });
                                    }
                                  },
                                  beforeSend: function () {
                                  }
                                });
                          });
                         
                        </script>
                    </div>
                    
                </div>
              </div>
          </div>
        </div>
    </div>
</html>