<html metal:use-macro="load: ../base.pt">
  <div metal:fill-slot="content">
    <script type='text/javascript'>
        $(document).ready(function () {
            $("#btn_close").click(function () {
                window.location = '/ap-invoice-item-skpd';
                return false;
            });
        });
    </script>
  <div  class="panel panel-default">
    <div class="panel-heading">
        <h3 class="panel-title">${request.title}</h3>
    </div>
    <div class="panel-body">
      <form method="post" accept-charset="utf-8" id="myform" class="form-horizontal" enctype="multipart/form-data">
        <div tal:condition="'id' in form" style="display:none;">
          <div tal:define="field form['id']">
              ${structure:field.serialize()}
          </div>
        </div>

          <!-- TAHUN -------------------------------------------------------------------->
        <div class="form-group"> 
          <div tal:define="field form['tahun_id']">
            <label for="${field.oid}" class="control-label col-md-1" id="req-${field.oid}">
                    ${field.title}</label>
            <div class="col-md-1">
               <input type="text" readonly class="form-control" id="${field.oid}" 
                      value="${request.session.tahun}" name="${field.oid}">
              <p id="error-${field.oid}" class="help-block" tal:condition="field.error"
                 tal:repeat="error field.error.messages()">
                 ${error}</p>
            </div>
          </div>

          <!-- UNIT -------------------------------------------------------------------->
          <div tal:define="field form['unit_id']" style="display: none;">
               <input type="text" class="form-control" id="${field.oid}" 
                      value="${request.session.unit_id}" readonly name="${field.oid}">
          </div>
          <div id="item-unit_kd">
            <label for="unit_kd" class="control-label col-md-1" id="req-unit_kd">
                    SKPD</label>
            <div class="col-md-2">
             <input type="text" class="form-control" id="unit_kd" 
                    name="unit_kd" value="${request.session.unit_kd}" readonly>
            </div>
          </div>
          <div class="col-md-7" id="item-unit_nm">
            <input type="text" class="form-control" id="unit_nm" 
                   name="unit_nm" value="${request.session.unit_nm}" readonly>
          </div>
        </div>

        <!--SPD-------------------------------------------------------------------->
        <div class="form-group"> 
          <div tal:define="field form['ap_spd_id']" style="display: none;">
              ${structure:field.serialize()}
          </div>
          <div tal:define="field form['spd_kd']"  id="item-${field.oid}">
            <label for="${field.oid}" class="control-label col-md-1" id="req-${field.oid}">
                    ${field.title}</label>
            <div class="col-md-2">
               ${structure:field.serialize()}
                <p id="error-${field.oid}" class="help-block" tal:condition="field.error"
                   tal:repeat="error field.error.messages()">
                   ${error}</p>
            </div>
          </div>

          <div class="col-md-5" tal:define="field form['spd_nm']" id="item-${field.oid}">
               ${structure:field.serialize()}
                <p id="error-${field.oid}" class="help-block" tal:condition="field.error"
                   tal:repeat="error field.error.messages()">
                   ${error}</p>
          </div>
          <div tal:define="field form['spd_tgl']"  id="item-${field.oid}">
            <label for="${field.oid}" class="control-label col-md-1" id="req-${field.oid}">
                    ${field.title}</label>
            <div class="col-md-2">
               ${structure:field.serialize()}
                <p id="error-${field.oid}" class="help-block" tal:condition="field.error"
                   tal:repeat="error field.error.messages()">
                   ${error}</p>
            </div>
          </div>
          <script>
               $('#spd_kd').typeahead({
                    "hint"     : true,
                    "highlight": true,
                    "minLength": 1,
                    "remote"   : "/ap-spd/act/headofkode1?term=%QUERY",
                  },
                  {
                  "name"      : 'spd_kd',
                  "displayKey": 'value',
                });
                $('#spd_nm').typeahead({
                    "hint"     : true,
                    "highlight": true,
                    "minLength": 1,
                    "remote"   : "/ap-spd/act/headofnama1?term=%QUERY",
                  },
                  {
                    "name"      : 'spd_nm',
                    "displayKey": 'value',
                  });
                  
              $('#spd_kd').bind('typeahead:selected', function(obj, datum, name) {      
                    $('#ap_spd_id').val(datum.id);
                    $('#spd_nm').val(datum.nama);
                    $('#spd_tgl').val(datum.tanggal);
                    $('#nilai').val(datum.nominal);
              });
              $('#spd_nm').bind('typeahead:selected', function(obj, datum, name) {      
                    $('#ap_spd_id').val(datum.id);
                    $('#spd_nm').val(datum.nama);
                    $('#spd_tgl').val(datum.tanggal);
                    $('#nilai').val(datum.nominal);
              });
              $("#spd_nm").attr('readonly',true);
              $("#spd_tgl").attr('readonly',true);
          </script>
        </div>

        <!--NO Urut-------------------------------------------------------------------->
        <div class="form-group"> 

          <div tal:define="field form['no_urut']" id="item-${field.oid}">
            <label for="${field.oid}" class="control-label col-md-1" id="req-${field.oid}">
                    ${field.title}</label>
            <div class="col-md-2">
               ${structure:field.serialize()}
              <p id="error-${field.oid}" class="help-block" tal:condition="field.error"
                 tal:repeat="error field.error.messages()">
                 ${error}</p>
            </div>
          </div>

          <div tal:define="field form['kode']" id="item-${field.oid}">
            <label for="${field.oid}" class="control-label col-md-1" id="req-${field.oid}">
                    ${field.title}</label>
            <div class="col-md-2">
               ${structure:field.serialize()}
              <p id="error-${field.oid}" class="help-block" tal:condition="field.error"
                 tal:repeat="error field.error.messages()">
                 ${error}</p>
            </div>
          </div>

          <!--Jenis-------------------------------------------------------------------->
          <div tal:define="field form['jenis']" id="item-${field.oid}">
            <label for="${field.oid}" class="control-label col-md-1" id="req-${field.oid}">
                    ${field.title}</label>
            <div class="col-md-1">
               ${structure:field.serialize()}
              <p id="error-${field.oid}" class="help-block" tal:condition="field.error"
                 tal:repeat="error field.error.messages()">
                 ${error}</p>
            </div>
          </div>
          
          <!--Tanggals-------------------------------------------------------------------->
          <div tal:define="field form['tanggal']" id="item-${field.oid}">
            <label for="${field.oid}" class="control-label col-md-1" id="req-${field.oid}">
                    ${field.title}</label>
            <div class="col-md-2">
               ${structure:field.serialize()}
              <p id="error-${field.oid}" class="help-block" tal:condition="field.error"
                 tal:repeat="error field.error.messages()">
                 ${error}</p>
            </div>
          </div>      
        </div>

        <!--Uraian-------------------------------------------------------------------->
        <div class="form-group"> 
          <div tal:define="field form['nama']" id="item-${field.oid}">
            <label for="${field.oid}" class="control-label col-md-1" id="req-${field.oid}">
                    ${field.title}</label>
            <div class="col-md-10">
               ${structure:field.serialize()}
              <p id="error-${field.oid}" class="help-block" tal:condition="field.error"
                 tal:repeat="error field.error.messages()">
                 ${error}</p>
            </div>
          </div>
        </div>

        <!---ap_nama------------------------------------------------------------------->
        <div class="form-group"> 
          <div tal:define="field form['ap_nama']" id="item-${field.oid}">
            <label for="${field.oid}" class="control-label col-md-1" id="req-${field.oid}">
                    ${field.title}</label>
            <div class="col-md-3">
               ${structure:field.serialize()}
              <p id="error-${field.oid}" class="help-block" tal:condition="field.error"
                 tal:repeat="error field.error.messages()">
                 ${error}</p>
            </div>
          </div>

          <!--ap_npwp-------------------------------------------------------------------->
          <div class="col-md-4"> 
            <div tal:define="field form['ap_npwp']" id="item-${field.oid}">
              <label for="${field.oid}" class="control-label col-md-2" id="req-${field.oid}">
                      ${field.title}</label>
              <div class="col-md-10">
                 ${structure:field.serialize()}
                <p id="error-${field.oid}" class="help-block" tal:condition="field.error"
                   tal:repeat="error field.error.messages()">
                   ${error}</p>
              </div>
            </div>
          </div>

          <!---ap_nip------------------------------------------------------------------->
          <div class="col-md-4"> 
            <div tal:define="field form['ap_nip']" id="item-${field.oid}">
              <label for="${field.oid}" class="control-label col-md-2" id="req-${field.oid}">
                      ${field.title}</label>
              <div class="col-md-10">
                 ${structure:field.serialize()}
                <p id="error-${field.oid}" class="help-block" tal:condition="field.error"
                   tal:repeat="error field.error.messages()">
                   ${error}</p>
              </div>
            </div>
          </div>
        </div>

        <!----ap_bank------------------------------------------------------------------>
        <div class="form-group"> 
          <div tal:define="field form['ap_bank']" id="item-${field.oid}">
            <label for="${field.oid}" class="control-label col-md-1" id="req-${field.oid}">
                    ${field.title}</label>
            <div class="col-md-3">
               ${structure:field.serialize()}
              <p id="error-${field.oid}" class="help-block" tal:condition="field.error"
                 tal:repeat="error field.error.messages()">
                 ${error}</p>
            </div>
          </div>

          <!---ap_rekening------------------------------------------------------------------->
          <div class="col-md-4"> 
            <div tal:define="field form['ap_rekening']" id="item-${field.oid}">
              <label for="${field.oid}" class="control-label col-md-2" id="req-${field.oid}">
                      ${field.title}</label>
              <div class="col-md-10">
                 ${structure:field.serialize()}
                <p id="error-${field.oid}" class="help-block" tal:condition="field.error"
                   tal:repeat="error field.error.messages()">
                   ${error}</p>
              </div>
            </div>
          </div>

          <!---nominal------------------------------------------------------------------->
          <div class="col-md-4"> 
            <div tal:define="field form['nominal']" id="item-${field.oid}">
              <label for="${field.oid}" class="control-label col-md-2" id="req-${field.oid}">
                      ${field.title}</label>
              <div class="col-md-10">
                 ${structure:field.serialize()}
                <p id="error-${field.oid}" class="help-block" tal:condition="field.error"
                   tal:repeat="error field.error.messages()">
                   ${error}</p>
              </div>
            </div>
          </div>        
        </div>        

        <!--nip------------------------------------------------------------------------>
        <div class="form-group"> 
          <div tal:define="field form['ttd_uid']" style="display: none;">
            ${structure:field.serialize()}
          </div>
          <div tal:define="field form['ttd_nip']" id="item-${field.oid}">
            <label for="${field.oid}" class="control-label col-md-1" id="req-${field.oid}">
                    ${field.title}</label>
            <div class="col-md-3">
               ${structure:field.serialize()}
              <p id="error-${field.oid}" class="help-block" tal:condition="field.error"
                 tal:repeat="error field.error.messages()">
                 ${error}</p>
            </div>
          </div>

          <!---ttd_nama------------------------------------------------------------------->
          <div class="col-md-4"> 
            <div tal:define="field form['ttd_nama']" id="item-${field.oid}">
              <label for="${field.oid}" class="control-label col-md-2" id="req-${field.oid}">
                      ${field.title}</label>
              <div class="col-md-10">
                 ${structure:field.serialize()}
                <p id="error-${field.oid}" class="help-block" tal:condition="field.error"
                   tal:repeat="error field.error.messages()">
                   ${error}</p>
              </div>
            </div>
          </div>

          <!---ttd_jab------------------------------------------------------------------->
          <div class="col-md-4"> 
            <div tal:define="field form['ttd_jab']" id="item-${field.oid}">
              <label for="${field.oid}" class="control-label col-md-2" id="req-${field.oid}">
                      ${field.title}</label>
              <div class="col-md-10">
                 ${structure:field.serialize()}
                <p id="error-${field.oid}" class="help-block" tal:condition="field.error"
                   tal:repeat="error field.error.messages()">
                   ${error}</p>
              </div>
            </div>
          </div>
           <script>
          $('#ttd_nip').typeahead({
              "hint"     : true,
              "highlight": true,
              "minLength": 1,
              "remote"   : "/pejabat/act/headofnip2?term=%QUERY",
            },
            {
              "name"      : 'ttd_nip',
              "displayKey": 'value',
            });
          $('#ttd_nama').typeahead({
              "hint"     : true,
              "highlight": true,
              "minLength": 1,
              "remote"   : "/pejabat/act/headofnama2?term=%QUERY",
            },
            {
              "name"      : 'ttd_nama',
              "displayKey": 'value',
            });
        
        $('#ttd_nama').bind('typeahead:selected', function(obj, datum, name) {  
              $('#ttd_uid').val(datum.kode);
              $('#ttd_nip').val(datum.nip);
              $('#pejabat_id').val(datum.id);
              $('#ttd_jab').val(datum.jab);
        });
        $('#ttd_nip').bind('typeahead:selected', function(obj, datum, name) {  
              $('#ttd_uid').val(datum.kode);
              $('#ttd_nama').val(datum.nama);
              $('#pejabat_id').val(datum.id);
              $('#ttd_jab').val(datum.jab);
        });

        $("#ttd_jab").attr('readonly',true);
        $("#ttd_nip").attr('readonly',true);
        </script>
        </div>
        
        <!----barang_nip------------------------------------------------------------------>
        <div class="form-group"> 
          <div tal:define="field form['barang_uid']" style="display: none;">
            ${structure:field.serialize()}
          </div>
          <div tal:define="field form['barang_nip']" id="item-${field.oid}">
            <label for="${field.oid}" class="control-label col-md-1" id="req-${field.oid}">
                    ${field.title}</label>
            <div class="col-md-3">
               ${structure:field.serialize()}
              <p id="error-${field.oid}" class="help-block" tal:condition="field.error"
                 tal:repeat="error field.error.messages()">
                 ${error}</p>
            </div>
          </div>

          <!---ttd_nama------------------------------------------------------------------->
          <div class="col-md-4"> 
            <div tal:define="field form['barang_nama']" id="item-${field.oid}">
              <label for="${field.oid}" class="control-label col-md-2" id="req-${field.oid}">
                      ${field.title}</label>
              <div class="col-md-10">
                 ${structure:field.serialize()}
                <p id="error-${field.oid}" class="help-block" tal:condition="field.error"
                   tal:repeat="error field.error.messages()">
                   ${error}</p>
              </div>
            </div>
          </div>

          <!---ttd_jab------------------------------------------------------------------->
          <div class="col-md-4"> 
            <div tal:define="field form['barang_jab']" id="item-${field.oid}">
              <label for="${field.oid}" class="control-label col-md-2" id="req-${field.oid}">
                      ${field.title}</label>
              <div class="col-md-10">
                 ${structure:field.serialize()}
                <p id="error-${field.oid}" class="help-block" tal:condition="field.error"
                   tal:repeat="error field.error.messages()">
                   ${error}</p>
              </div>
            </div>
          </div>
           <script>
           $('#barang_uid').typeahead({
              "hint"     : true,
              "highlight": true,
              "minLength": 1,
              "remote"   : "/pejabat/act/headofkode4?term=%QUERY",
            },
            {
            "name"      : 'barang_uid',
            "displayKey": 'value',
          });
          $('#barang_nip').typeahead({
              "hint"     : true,
              "highlight": true,
              "minLength": 1,
              "remote"   : "/pejabat/act/headofnip4?term=%QUERY",
            },
            {
              "name"      : 'barang_nip',
              "displayKey": 'value',
            });
          $('#barang_nama').typeahead({
              "hint"     : true,
              "highlight": true,
              "minLength": 1,
              "remote"   : "/pejabat/act/headofnama4?term=%QUERY",
            },
            {
              "name"      : 'barang_nama',
              "displayKey": 'value',
            });
          $('#barang_nip').typeahead({
              "hint"     : true,
              "highlight": true,
              "minLength": 1,
              "remote"   : "/pejabat/act/headofnip4?term=%QUERY",
            },
            {
              "name"      : 'barang_nip',
              "displayKey": 'value',
            });
        
        $('#barang_uid').bind('typeahead:selected', function(obj, datum, name) {  
              $('#barang_nama').val(datum.nama);
              $('#barang_nip').val(datum.nip);
              $('#pejabat_id').val(datum.id);
              $('#barang_jab').val(datum.jab);
        });
        $('#barang_nama').bind('typeahead:selected', function(obj, datum, name) {  
              $('#barang_uid').val(datum.kode);
              $('#barang_nip').val(datum.nip);
              $('#pejabat_id').val(datum.id);
              $('#barang_jab').val(datum.jab);
        });
        $('#barang_nip').bind('typeahead:selected', function(obj, datum, name) {  
              $('#barang_nama').val(datum.nama);
              $('#barang_uid').val(datum.kode);
              $('#pejabat_id').val(datum.id);
              $('#barang_jab').val(datum.jab);
        });
        $('#barang_jab').bind('typeahead:selected', function(obj, datum, name) {  
              $('#barang_nama').val(datum.nama);
              $('#barang_uid').val(datum.kode);
              $('#pejabat_id').val(datum.id);
              $('#barang_nip').val(datum.nip);
        });
        $("#barang_jab").attr('readonly',true);
        $("#barang_nip").attr('readonly',true);
        </script>
        </div>    

        <!--kasi_nip-------------------------------------------------------------------->
        <div class="form-group"> 
          <div tal:define="field form['kasi_uid']" style="display: none;">
            ${structure:field.serialize()}
          </div>
          <div tal:define="field form['kasi_nip']" id="item-${field.oid}">
            <label for="${field.oid}" class="control-label col-md-1" id="req-${field.oid}">
                    ${field.title}</label>
            <div class="col-md-3">
               ${structure:field.serialize()}
              <p id="error-${field.oid}" class="help-block" tal:condition="field.error"
                 tal:repeat="error field.error.messages()">
                 ${error}</p>
            </div>
          </div>

          <!---ttd_nama------------------------------------------------------------------->
          <div class="col-md-4"> 
            <div tal:define="field form['kasi_nama']" id="item-${field.oid}">
              <label for="${field.oid}" class="control-label col-md-2" id="req-${field.oid}">
                      ${field.title}</label>
              <div class="col-md-10">
                 ${structure:field.serialize()}
                <p id="error-${field.oid}" class="help-block" tal:condition="field.error"
                   tal:repeat="error field.error.messages()">
                   ${error}</p>
              </div>
            </div>
          </div>

          <!---ttd_jab------------------------------------------------------------------->
          <div class="col-md-4"> 
            <div tal:define="field form['kasi_jab']" id="item-${field.oid}">
              <label for="${field.oid}" class="control-label col-md-2" id="req-${field.oid}">
                      ${field.title}</label>
              <div class="col-md-10">
                 ${structure:field.serialize()}
                <p id="error-${field.oid}" class="help-block" tal:condition="field.error"
                   tal:repeat="error field.error.messages()">
                   ${error}</p>
              </div>
            </div>
          </div>
           <script>
           $('#kasi_uid').typeahead({
              "hint"     : true,
              "highlight": true,
              "minLength": 1,
              "remote"   : "/pejabat/act/headofkode4?term=%QUERY",
            },
            {
            "name"      : 'kasi_uid',
            "displayKey": 'value',
          });
          $('#kasi_nip').typeahead({
              "hint"     : true,
              "highlight": true,
              "minLength": 1,
              "remote"   : "/pejabat/act/headofnip4?term=%QUERY",
            },
            {
              "name"      : 'kasi_nip',
              "displayKey": 'value',
            });
          $('#kasi_nama').typeahead({
              "hint"     : true,
              "highlight": true,
              "minLength": 1,
              "remote"   : "/pejabat/act/headofnama4?term=%QUERY",
            },
            {
              "name"      : 'kasi_nama',
              "displayKey": 'value',
            });
          $('#kasi_nip').typeahead({
              "hint"     : true,
              "highlight": true,
              "minLength": 1,
              "remote"   : "/pejabat/act/headofnip4?term=%QUERY",
            },
            {
              "name"      : 'kasi_nip',
              "displayKey": 'value',
            });
        
        $('#kasi_uid').bind('typeahead:selected', function(obj, datum, name) {  
              $('#kasi_nama').val(datum.nama);
              $('#kasi_nip').val(datum.nip);
              $('#pejabat_id').val(datum.id);
              $('#kasi_jab').val(datum.jab);
        });
        $('#kasi_nama').bind('typeahead:selected', function(obj, datum, name) {  
              $('#kasi_uid').val(datum.kode);
              $('#kasi_nip').val(datum.nip);
              $('#pejabat_id').val(datum.id);
              $('#kasi_jab').val(datum.jab);
        });
        $('#kasi_nip').bind('typeahead:selected', function(obj, datum, name) {  
              $('#kasi_nama').val(datum.nama);
              $('#kasi_uid').val(datum.kode);
              $('#pejabat_id').val(datum.id);
              $('#kasi_jab').val(datum.jab);
        });
        $('#kasi_jab').bind('typeahead:selected', function(obj, datum, name) {  
              $('#kasi_nama').val(datum.nama);
              $('#kasi_uid').val(datum.kode);
              $('#pejabat_id').val(datum.id);
              $('#kasi_nip').val(datum.nip);
        });
        $("#kasi_jab").attr('readonly',true);
        $("#kasi_nip").attr('readonly',true);
        </script>
        </div>    

        <!--pptk_nip-------------------------------------------------------------------->
        <div class="form-group"> 
          <div tal:define="field form['pptk_uid']" style="display: none;">
            ${structure:field.serialize()}
          </div>
          <div tal:define="field form['pptk_nip']" id="item-${field.oid}">
            <label for="${field.oid}" class="control-label col-md-1" id="req-${field.oid}">
                    ${field.title}</label>
            <div class="col-md-3">
               ${structure:field.serialize()}
              <p id="error-${field.oid}" class="help-block" tal:condition="field.error"
                 tal:repeat="error field.error.messages()">
                 ${error}</p>
            </div>
          </div>

          <!---ttd_nama------------------------------------------------------------------->
          <div class="col-md-4"> 
            <div tal:define="field form['pptk_nama']" id="item-${field.oid}">
              <label for="${field.oid}" class="control-label col-md-2" id="req-${field.oid}">
                      ${field.title}</label>
              <div class="col-md-10">
                 ${structure:field.serialize()}
                <p id="error-${field.oid}" class="help-block" tal:condition="field.error"
                   tal:repeat="error field.error.messages()">
                   ${error}</p>
              </div>
            </div>
          </div>
           <script>
           $('#pptk_uid').typeahead({
              "hint"     : true,
              "highlight": true,
              "minLength": 1,
              "remote"   : "/pejabat/act/headofkode5?term=%QUERY",
            },
            {
            "name"      : 'pptk_uid',
            "displayKey": 'value',
          });
          $('#pptk_nip').typeahead({
              "hint"     : true,
              "highlight": true,
              "minLength": 1,
              "remote"   : "/pejabat/act/headofnip5?term=%QUERY",
            },
            {
              "name"      : 'pptk_nip',
              "displayKey": 'value',
            });
          $('#pptk_nama').typeahead({
              "hint"     : true,
              "highlight": true,
              "minLength": 1,
              "remote"   : "/pejabat/act/headofnama5?term=%QUERY",
            },
            {
              "name"      : 'pptk_nama',
              "displayKey": 'value',
            });
        
        $('#pptk_uid').bind('typeahead:selected', function(obj, datum, name) {  
              $('#pptk_nama').val(datum.nama);
              $('#pptk_nip').val(datum.nip);
              $('#pejabat_id').val(datum.id);
              $('#pptk_jab').val(datum.jab);
        });
        $('#pptk_nama').bind('typeahead:selected', function(obj, datum, name) {  
              $('#pptk_uid').val(datum.kode);
              $('#pptk_nip').val(datum.nip);
              $('#pejabat_id').val(datum.id);
              $('#pptk_jab').val(datum.jab);
        });
        $('#pptk_nip').bind('typeahead:selected', function(obj, datum, name) {  
              $('#pptk_nama').val(datum.nama);
              $('#pptk_uid').val(datum.kode);
              $('#pejabat_id').val(datum.id);
              $('#pptk_jab').val(datum.jab);
        });
        $("#pptk_nip").attr('readonly',true);
        </script>
          <div class="col-md-4"> 
            <button type="submit" class="btn btn-primary" id="simpan" name="simpan" >Simpan</button>
            <button type="submit" class="btn btn-warning" id="tutup" name="tutup">Tutup</button>
          </div>
        </div>         
      </form>
    </div>  
  </div>  
      <div class="row">
        <table class="table table-bordered table-hover table-condensed" id="table1">
          <thead>
              <tr>
                <th>Index</th>
                <th>No. Tagihan</th>
                <th>No. Tagihan</th>
                <th>Jenis</th>
                <th>Tanggal</th>
                <th>Uraian</th>
                <th>Nilai</th>
              </tr>
          </thead>
          <tbody>
          </tbody>
      </table>
      </div>
      <div  class="panel panel-default">
          <div class="panel-heading">
              <h5 class="panel-title">Tambah Tagihan / Utang</h5>
          </div>
      <div class="panel-body">
       <form method="post" id="detail" accept-charset="utf-8" id="myform" class="form-horizontal" enctype="multipart/form-data">
        <fieldset class="deformFormFieldset">
              <!--APIncoice------------------------------------------------------------->
          <input id="ap_spp_item_id" type="hidden" value="" name="ap_spp_item_id">
          <input id="ap_invoice_id" type="hidden" value="" name="ap_invoice_id">
          <input id="nilai" type="hidden" value="" name="nilai">
          <div class="form-group">
            <label for="kode1" class="control-label col-md-1" id="req-kode1">
                    Tagihan </label>
            <div class="col-md-2">
               <input id="kode1" class=" form-control " type="text" value="" name="kode1">
            </div>
            <div class="col-md-5">
               <input id="nama1" class=" form-control " readonly type="text" value="" name="nama1">
            </div>
            <div class="col-md-2">
               <input id="amount1" class=" form-control " readonly type="text" value="0" name="amount1">
            </div>
            <!--Button----------------------------------------------------------->
            <div class="col-md-2">
                <button id="rekening_add" name="baru" type="button" class="btn btn-primary "
                    value="baru">Baru</button>
                <button id="rekening_cancel" name="batal" type="reset" class="btn btn-danger "
                    value="batal">Batal</button>
            </div> 
          </div>

          <div class="form-group">
            <label for="no_bku" class="control-label col-md-1" id="req-no_bku">
                    No BKU </label>
            <div class="col-md-2">
               <input id="no_bku" class=" form-control " readonly type="text" value="" name="no_bku">
            </div>
            <label for="tgl_bku" class="control-label col-md-1" id="req-tgl_bku">
                    Tgl BKU </label>
            <div class="col-md-2">
               <input id="tgl_bku" class=" form-control " readonly type="text" value="" name="tgl_bku">
            </div>
          </div>
          <script>
            $('#rekening_add').click(function () {
                /**var jenis = $('#jenis').val();
                var jml_total = parseInt($('#jml_total').val());
                var amount1 = parseInt($('#amount1').val());
                var hasil = jml_total+amount1;
                alert(hasil);*/

                $('#ap_spp_item_id').val('');
                  $('#detail').submit();
             })
            $('#kode1').typeahead({
                "hint"     : true,
                "highlight": true,
                "minLength": 1,
                "remote"   : "/ap-invoice-skpd/act/headofkode1?jenis="+$('#jenis').val()+"&term=%QUERY", 
            },{
               "name"      : 'kode1',
               "displayKey": 'value',
            });           
          
            $('#kode1').bind('typeahead:selected', function(obj, datum, name) {  
                  $('#ap_invoice_id').val(datum.id);
                  $('#nama1').val(datum.nama);
                  $('#amount1').val(datum.amount);   
                  $('#no_bku').val(datum.no_bku);
                  $('#tgl_bku').val(datum.tgl_bku);                
            });
              
            $( "#detail" ).submit(function( event ) {
              var ap_spp_id;
              var is_success;
              is_success = true;
              ap_spp_id = $('#id').val();
              if (!ap_spp_id) {
                  is_success = false;
                  $("#errors").css('display', 'inline', 'important');
                  $("#errors").html("<span class='glyphicon glyphicon-remove'></span> " + 'Simpan Dulu Headernya');
              }
          
              if (is_success){
                $.ajax({
                  type: "POST",
                  url: "/ap-spp/item/"+ap_spp_id+"/add",
                  data: $('#detail').serialize(),
                  success: function (html) {
                    if (html.success == true) {
                      $("#errors").html("<span class='glyphicon glyphicon-ok'></span> " + html.msg);
                      $('#kode1').val('');
                      $('#nama1').val('');
                      $('#amount1').val(0);
                      $('#no_bku').val('');
                      $('#tgl_bku').val('');
                      $('#jml_total').val(formatNumber(html.jml_total));
                      oTable.fnReloadAjax(oTableUrl);
                    } else {
                      $("#errors").css('display', 'inline', 'important');
                      $("#errors").html("<span class='glyphicon glyphicon-remove'></span> " + html.msg);
                    }
                  },
                  beforeSend: function () {
                    $("#errors").css('display', 'inline', 'important');
                    $("#errors").html("<img src=\'${request.static_url('osipkd:static/images/ajax-loader.gif')}\' /> Loading...")
                  }
                });
              }
              event.preventDefault();
            });
          </script> 
        </fieldset>
       </form>
      </div>       
     </div> <!--panel-body-->

    <script>
      var mID;
      var oTable;
      var iPos;
      var ap_spp_id = $('#id').val();
      var oTableUrl = "/ap-spp/item/"+ap_spp_id+"/act/grid";
      var tb_array = [
          '<div class="btn-group pull-left">',
          '	<button id="btn_delete" class="btn btn btn-danger"  type="button">Hapus</button>',
          '	<!--button id="btn_print"  class="btn btn btn-primary" type="button">Print</button-->',
          ' <!--button id="btn_close"  class="btn btn-warning"     type="button">Tutup</button-->',
          '	&nbsp;',
          '</div>',
      ];

      var tb = tb_array.join(' ');

      function formatNumber(n) {
         return n.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
      }

      $(document).ready(function () {
        oTable = $('#table1').dataTable({
            "sAjaxSource"    : oTableUrl,
            "bServerSide"    : true,
            "bProcessing"    : true,           
            "sDom"           : '<"toolbar">lfrtip',
            "bScrollCollapse": true,
            "bSort"          : true,
            "bInfo"          : false,
            "bFilter"        : false,
            "bAutoWidth"     : false,
            "bPaginate"      : true,
            "sPaginationType": "full_numbers",

            "lengthMenu": [
                [5, 10, 15, 25, 50, -1],
                [5, 10, 15, 25, 50, "All"]
            ],
            "aoColumnDefs": [{
                "bSearchable": false,
                "bVisible"   : false,
                "aTargets"   : [0,1,7,8]
            },{
                "bSearchable": true,
                "bSortable"  : false,
                "aTargets"   : [2,5]
            },{
                "bSearchable": false,
                "bSortable"  : false,
                "aTargets"   : [3,4,6]
            },{
                "aTargets" : [3], // Column number which needs to be modified
                "mRender"  : function (data, type, full) {
                    if (data == "1") {
                        return 'UP';
                    } else if (data == "2") {
                        return 'TU';
                    } else if (data == "3") {
                        return 'GU';
                    } else if (data == "4") {
                        return 'LS';
                    }
                }
            }],
            "aoColumns": [
                null, 
                {"sWidth": "50px"}, 
                {"sWidth": "50px"},
                {"sWidth": "30px"}, 
                {"sWidth": "30px"}, 
                {"sWidth": "120px"},
                {"sWidth": "50px", "sClass": "right"},
            ],
            "fnRowCallback": function (nRow, aData, iDisplayIndex) {
                $(nRow).on("click", function (event) {
                    if ($(this).hasClass('row_selected')) {
                        /* mID = '';
                        $(this).removeClass('row_selected'); */
                    } else {

                        var data = oTable.fnGetData(this);
                        mID = data[0];
                        $("#ap_spp_item_id").val(data[0]);
                        $("#ap_invoice_id").val(data[1]);
                        $("#kode1").val(data[2]);
                        $("#nama1").val(data[5]);
                        $("#amount1").val(data[6]);  
                        $("#no_bku").val(data[7]);
                        $("#tgl_bku").val(data[8]);                       
                        oTable.$('tr.row_selected').removeClass('row_selected');
                        $(this).addClass('row_selected');
                    }
                })
            },
        });

        $("div.toolbar").html(tb);

        $('#table1 tbody').on('click', 'tr', function () {
            if ($(this).hasClass('selected')) {
                $(this).removeClass('selected');
            } else {
                iPos = oTable.fnGetPosition(this);
                var aData = oTable.fnGetData(iPos);
                mID = aData[0];
                oTable.$('tr.selected').removeClass('selected');
                $(this).addClass('selected');
            }
        });
        /**********************************************************************/
        $('#btn_delete').click(function () {
            if (mID) {
              if (confirm('Yakin dihapus?')==true){
                $.ajax({
                type: "POST",
                url: "/ap-spp/item/"+$("#id").val()+"/"+mID+"/delete",
                success: function (html) {
                  if (html.success == true) {
                    $("#errors").html("<span class='glyphicon glyphicon-ok'></span> " + html.msg);
                    $('#kode1').val('');
                    $('#nama1').val('');
                    $('#no_bku').val('');
                    $('#tgl_bku').val('');
                    $('#amount1').val(0);

                    if(html.jml_total=="None"){
                      $('#jml_total').val(0);}
                    else{
                      $('#jml_total').val(formatNumber(html.jml_total));} 

                    oTable.fnReloadAjax(oTableUrl);
                  } else {
                    $("#errors").css('display', 'inline', 'important');
                    $("#errors").html("<span class='glyphicon glyphicon-remove'></span> " + html.msg);
                  }
                },
                beforeSend: function () {
                  $("#errors").css('display', 'inline', 'important');
                  $("#errors").html("<img src=\'${request.static_url('osipkd:static/images/ajax-loader.gif')}\' /> Loading...")
                }
                });
              } else {
                  alert('Silahkan pilih data yang akan di hapus');
              }
            }
        });
        $('#btn_print').click(function () {
            alert('Masih Proses Bung!');
        });
        $("#btn_close").click(function () {
            window.location = '/ap-spp';
            return false;
        });
        
        $("#no_urut").attr('readonly',true);
        $("#jml_total").attr('readonly',true);
        jml_total=$("#jml_total").val();
        $("#jml_total").val(formatNumber(jml_total));
     });
    </script>
  </div>
</html>