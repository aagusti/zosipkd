<html metal:use-macro="load: ../base.pt">
  <div metal:fill-slot="content">
    <script type='text/javascript'>
        $(document).ready(function () {
            $("#btn_close").click(function () {
                window.location = '/ap-payment-item';
                return false;
            });
        });
    </script>
   <div  class="panel panel-default">
    <div class="panel-heading">
        <h3 class="panel-title">${request.title}</h3>
    </div>
    <div class="panel-body">
      <form method="post" accept-charset="utf-8" id="myform" class="form-horizontal" enctype="multipart/form-data">
      <div tal:condition="'id' in form">
        <div tal:define="field form['id']" style="display: none;">
            ${structure:field.serialize()}
        </div>
      </div>
         
      <div class="form-group"> 
        
        <div tal:define="field form['tahun_id']">
          <label for="${field.oid}" class="control-label col-md-1" id="req-${field.oid}">
                  ${field.title}</label>
          <div class="col-md-1">
             <input type="text" class="form-control" id="${field.oid}" 
                    value="${request.session.tahun}" readonly name="${field.oid}">
            <p id="error-${field.oid}" class="help-block" tal:condition="field.error"
               tal:repeat="error field.error.messages()">
               ${error}</p>
          </div>
        </div>
        <!-- UNIT -------------------------------------------------------------------->
        <div tal:define="field form['unit_id']" style="display: none;">
             <input type="text" class="form-control" id="${field.oid}" 
                    value="${request.session.unit_id}" readonly name="${field.oid}">
        </div>
        
        <div id="item-unit_kd">
          <label for="unit_kd" class="control-label col-md-1" id="req-unit_kd">
                  SKPD</label>
          <div class="col-md-2">
           <input type="text" class="form-control" id="unit_kd" 
                  name="unit_kd" value="${request.session.unit_kd}" readonly>
          </div>
        </div>
        <div class="col-md-6" id="item-unit_nm">
          <input type="text" class="form-control" id="unit_nm" 
                 name="unit_nm" value="${request.session.unit_nm}" readonly>
        </div>
      </div>
      
      <!--Invoice--===-------------------------------------------------------------------->
      <div class="form-group"> 
        <div tal:define="field form['invoice_id']" style="display: none;">
            ${structure:field.serialize()}
        </div>
        <div tal:define="field form['inv_kd']" id="item-${field.oid}">
          <label for="${field.oid}" class="control-label col-md-1" id="req-${field.oid}">
                  ${field.title}</label>
          <div class="col-md-2">
             ${structure:field.serialize()}
            <p id="error-${field.oid}" class="help-block" tal:condition="field.error"
               tal:repeat="error field.error.messages()">
               ${error}</p>
          </div>
        </div>
        
        <div class="col-md-8" tal:define="field form['inv_nm']" id="item-${field.oid}">
          ${structure:field.serialize()}
          <p id="error-${field.oid}" class="help-block" tal:condition="field.error"
             tal:repeat="error field.error.messages()">
             ${error}</p>
        </div>
        <script>
            $('#inv_kd').typeahead({
              "hint"     : true,
              "highlight": true,
              "minLength": 1,
              "remote"   : "/ap-invoice-skpd/act/headofkode2?term=%QUERY",
            },{
             "name"      : 'inv_kd',
             "displayKey": 'value',
            });
            $('#inv_nm').typeahead({
              "hint"     : true,
              "highlight": true,
              "minLength": 1,
              "remote"   : "/ap-invoice-skpd/act/headofnama2?term=%QUERY",
            },{
             "name"      : 'inv_nm',
             "displayKey": 'value',
            });

        
        $('#inv_kd').bind('typeahead:selected', function(obj, datum, name) {  
              $('#inv_nm').val(datum.nama);
              $('#invoice_id').val(datum.id);
              $('#jml_total').val(datum.amount);
              $('#nama').val(datum.nama);
              $('#no_bku').val(datum.no_bku);
              
              if(datum.tgl_bku == 'None'){
                  $('#tgl_bku').val('');
              }else{
                  $('#tgl_bku').val(datum.tgl_bku);
              }
              
              $('#jenis').val(datum.jenis);
              $('#no_bast').val(datum.no_bast);
              
              if(datum.tgl_bast == 'None'){
                  $('#tgl_bast').val('');
              }else{
                  $('#tgl_bast').val(datum.tgl_bast);
              }
              
              $('#is_bayar').val(datum.is_bayar);
              $('#ap_nama').val(datum.ap_nama);
              $('#ap_rekening').val(datum.ap_rekening);
              $('#ap_npwp').val(datum.ap_npwp);
              $('#ap_waktu').val(datum.ap_waktu);
              $('#ap_uraian').val(datum.ap_uraian);
              $('#ap_pemilik').val(datum.ap_pemilik);
              $('#ap_alamat').val(datum.ap_alamat);
              $('#ap_bentuk').val(datum.ap_bentuk);
              $('#ap_kontrak').val(datum.ap_kontrak);
              
              if(datum.ap_tgl_kontrak == 'None'){
                  $('#ap_tgl_kontrak').val('');
              }else{
                  $('#ap_tgl_kontrak').val(datum.ap_tgl_kontrak);
              }
              
              $('#ap_nilai').val(datum.ap_nilai);
              $('#ap_kwitansi_no').val(datum.ap_kwitansi_no);
              
              if(datum.ap_kwitansi_tgl == 'None'){
                  $('#ap_kwitansi_tgl').val('');
              }else{
                  $('#ap_kwitansi_tgl').val(datum.ap_kwitansi_tgl);
              }
              
              $('#ap_kwitansi_nilai').val(datum.ap_kwitansi_nilai);
              $('#ap_bap_no').val(datum.ap_bap_no);
              
              if(datum.ap_bap_tgl == 'None'){
                  $('#ap_bap_tgl').val('');
              }else{
                  $('#ap_bap_tgl').val(datum.ap_bap_tgl);
              }
              
              $('#kegiatan_nm').val(datum.kegiatan_nm);
              $('#kegiatan_kd').val(datum.kegiatan_kd);
              $('#kegiatan_sub_id').val(datum.kegiatan_sub_id);
        });
        $('#inv_nm').bind('typeahead:selected', function(obj, datum, name) {  
              $('#inv_kd').val(datum.kode);
              $('#invoice_id').val(datum.id);
              $('#jml_total').val(datum.amount);
              $('#nama').val(datum.nama);
              $('#no_bku').val(datum.no_bku);
              
              if(datum.tgl_bku == 'None'){
                  $('#tgl_bku').val('');
              }else{
                  $('#tgl_bku').val(datum.tgl_bku);
              }
              
              $('#jenis').val(datum.jenis);
              $('#no_bast').val(datum.no_bast);
              
              if(datum.tgl_bast == 'None'){
                  $('#tgl_bast').val('');
              }else{
                  $('#tgl_bast').val(datum.tgl_bast);
              }
              
              $('#is_bayar').val(datum.is_bayar);
              $('#ap_nama').val(datum.ap_nama);
              $('#ap_rekening').val(datum.ap_rekening);
              $('#ap_npwp').val(datum.ap_npwp);
              $('#ap_waktu').val(datum.ap_waktu);
              $('#ap_uraian').val(datum.ap_uraian);
              $('#ap_pemilik').val(datum.ap_pemilik);
              $('#ap_alamat').val(datum.ap_alamat);
              $('#ap_bentuk').val(datum.ap_bentuk);
              $('#ap_kontrak').val(datum.ap_kontrak);
              
              if(datum.ap_tgl_kontrak == 'None'){
                  $('#ap_tgl_kontrak').val('');
              }else{
                  $('#ap_tgl_kontrak').val(datum.ap_tgl_kontrak);
              }
              
              $('#ap_nilai').val(datum.ap_nilai);
              $('#ap_kwitansi_no').val(datum.ap_kwitansi_no);
              
              if(datum.ap_kwitansi_tgl == 'None'){
                  $('#ap_kwitansi_tgl').val('');
              }else{
                  $('#ap_kwitansi_tgl').val(datum.ap_kwitansi_tgl);
              }
              
              $('#ap_kwitansi_nilai').val(datum.ap_kwitansi_nilai);
              $('#ap_bap_no').val(datum.ap_bap_no);
              
              if(datum.ap_bap_tgl == 'None'){
                  $('#ap_bap_tgl').val('');
              }else{
                  $('#ap_bap_tgl').val(datum.ap_bap_tgl);
              }
              
              $('#kegiatan_nm').val(datum.kegiatan_nm);
              $('#kegiatan_kd').val(datum.kegiatan_kd);
              $('#kegiatan_sub_id').val(datum.kegiatan_sub_id);
        });
        //$("#inv_nm").attr('readonly',true);
        </script>
      </div>
      
      <!--Kegiatans-------------------------------------------------------------------->
      <div class="form-group"> 
        <div tal:define="field form['kegiatan_sub_id']" style="display: none;">
            ${structure:field.serialize()}
        </div>
        <div tal:define="field form['kegiatan_kd']" id="item-${field.oid}">
          <label for="${field.oid}" class="control-label col-md-1" id="req-${field.oid}">
                  ${field.title}</label>
          <div class="col-md-2">
             ${structure:field.serialize()}
            <p id="error-${field.oid}" class="help-block" tal:condition="field.error"
               tal:repeat="error field.error.messages()">
               ${error}</p>
          </div>
        </div>
        
        <div class="col-md-8" tal:define="field form['kegiatan_nm']" id="item-${field.oid}">
          ${structure:field.serialize()}
          <p id="error-${field.oid}" class="help-block" tal:condition="field.error"
             tal:repeat="error field.error.messages()">
             ${error}</p>
        </div>
        <script>
            $('#kegiatan_kd').typeahead({
              "hint"     : true,
              "highlight": true,
              "minLength": 1,
              "remote"   : "/ag-kegiatan-sub/act/headofkode1?term=%QUERY",
            },{
             "name"      : 'kegiatan_kd',
             "displayKey": 'value',
            });
            $('#kegiatan_nm').typeahead({
              "hint"     : true,
              "highlight": true,
              "minLength": 1,
              "remote"   : "/ag-kegiatan-sub/act/headofnama1?term=%QUERY",
            },{
             "name"      : 'kegiatan_nm',
             "displayKey": 'value',
            });

        
        $('#kegiatan_kd').bind('typeahead:selected', function(obj, datum, name) {  
              $('#kegiatan_nm').val(datum.nama);
              $('#kegiatan_sub_id').val(datum.id);
        });
        $('#kegiatan_nm').bind('typeahead:selected', function(obj, datum, name) {  
              $('#kegiatan_kd').val(datum.kode);
              $('#kegiatan_sub_id').val(datum.id);
        });
        $("#kegiatan_nm").attr('readonly',true);
        $("#kegiatan_kd").attr('readonly',true);
        </script>
      </div>
      
      <!--No Urut-------------------------------------------------------------------->
      <div class="form-group"> 
        <div tal:define="field form['no_urut']" id="item-${field.oid}">
          <label for="${field.oid}" class="control-label col-md-1" id="req-${field.oid}">
                  ${field.title}</label>
          <div class="col-md-2">
             ${structure:field.serialize()}
            <p id="error-${field.oid}" class="help-block" tal:condition="field.error"
               tal:repeat="error field.error.messages()">
               ${error}</p>
          </div>
        </div>
        <!--Jenis-------------------------------------------------------------------->
        <div tal:define="field form['jenis']" id="item-${field.oid}">
          <label for="${field.oid}" class="control-label col-md-1" id="req-${field.oid}">
                  ${field.title}</label>
          <div class="col-md-2">
             ${structure:field.serialize()}
            <p id="error-${field.oid}" class="help-block" tal:condition="field.error"
               tal:repeat="error field.error.messages()">
               ${error}</p>
          </div>
        <script>
        $(document).ready(function(){
            //Hide All Kondisi
            $('#no_bku').hide();
            $('#no_bku1').hide();
            $('#tgl_bku').hide();
            $('#tgl_bku1').hide();
            $('#is_bayar').hide();
            $('#is_bayar1').hide();

            //Hide Show Jenis saat edit
            var jenis = $("#jenis").val();
            if (jenis =='3'){
                $('#no_bku').show();
                $('#no_bku1').show();
                $('#tgl_bku').show();
                $('#tgl_bku1').show();
                $('#is_bayar').show();
                $('#is_bayar1').show();
            }else{
                $('#no_bku').hide();
                $('#no_bku1').hide();
                $('#tgl_bku').hide();
                $('#tgl_bku1').hide();
                $('#is_bayar').hide();
                $('#is_bayar1').hide();
            }

            //Hide Show Jenis saat pilih/ entry
            $("#jenis").change(function(){
            var jenis1 = $("#jenis").val();
            if(jenis1=='3'){
                $('#no_bku').show();
                $('#no_bku1').show();
                $('#tgl_bku').show();
                $('#tgl_bku1').show();
                $('#is_bayar').show();
                $('#is_bayar1').show();
            }else{
                $('#no_bku').hide();
                $('#no_bku1').hide();
                $('#tgl_bku').hide();
                $('#tgl_bku1').hide();
                $('#is_bayar').hide();
                $('#is_bayar1').hide();
            }
            });
        });
        </script>
        </div>
        <!--Bku-------------------------------------------------------------------->
        <div tal:define="field form['no_bku']" id="item-${field.oid}">
          <label for="${field.oid}" class="control-label col-md-1" id="no_bku1">
                  ${field.title}</label>
          <div class="col-md-2">
             ${structure:field.serialize()}
            <p id="error-${field.oid}" class="help-block" tal:condition="field.error"
               tal:repeat="error field.error.messages()">
               ${error}</p>
          </div>
        </div>
        <div tal:define="field form['tgl_bku']" id="item-${field.oid}">
          <label for="${field.oid}" class="control-label col-md-1" id="tgl_bku1">
                  ${field.title}</label>
          <div class="col-md-2">
             ${structure:field.serialize()}
            <p id="error-${field.oid}" class="help-block" tal:condition="field.error"
               tal:repeat="error field.error.messages()">
               ${error}</p>
          </div>
        </div>
      </div>
      <!--Kode-------------------------------------------------------------------->
      <div class="form-group"> 
        <div tal:define="field form['kode']" id="item-${field.oid}">
          <label for="${field.oid}" class="control-label col-md-1" id="req-${field.oid}">
                  ${field.title}</label>
          <div class="col-md-2">
             ${structure:field.serialize()}
            <p id="error-${field.oid}" class="help-block" tal:condition="field.error"
               tal:repeat="error field.error.messages()">
               ${error}</p>
          </div>
        </div>
        <!--Uraian-------------------------------------------------------------------->
        <div tal:define="field form['nama']" id="item-${field.oid}">
          <label for="${field.oid}" class="control-label col-md-1" id="req-${field.oid}">
                  ${field.title}</label>
          <div class="col-md-5">
             ${structure:field.serialize()}
            <p id="error-${field.oid}" class="help-block" tal:condition="field.error"
               tal:repeat="error field.error.messages()">
               ${error}</p>
          </div>
        </div>

        <!--tanggal-------------------------------------------------------------------->
        <div tal:define="field form['tanggal']" id="item-${field.oid}">
          <label for="${field.oid}" class="control-label col-md-1" id="req-${field.oid}">
                  ${field.title}</label>
          <div class="col-md-2">
             ${structure:field.serialize()}
            <p id="error-${field.oid}" class="help-block" tal:condition="field.error"
               tal:repeat="error field.error.messages()">
               ${error}</p>
          </div>
        </div>
      </div>


      <div class="form-group"> 
        <div tal:define="field form['no_bast']" id="item-${field.oid}">
          <label for="${field.oid}" class="control-label col-md-1" id="req-${field.oid}">
                  ${field.title}</label>
          <div class="col-md-3">
              ${structure:field.serialize()}
          </div>
          <p id="error-${field.oid}" class="help-block" tal:condition="field.error"
             tal:repeat="error field.error.messages()">
             ${error}</p>
        </div>
        <div tal:define="field form['tgl_bast']" id="item-${field.oid}">
          <label for="${field.oid}" class="control-label col-md-2" id="req-${field.oid}">
                  ${field.title}</label>
          <div class="col-md-3">
             ${structure:field.serialize()}
            <p id="error-${field.oid}" class="help-block" tal:condition="field.error"
               tal:repeat="error field.error.messages()">
               ${error}</p>
          </div>
        </div>
        <!--Dibayar-------------------------------------------------------------------->
        <div tal:define="field form['is_bayar']" id="item-${field.oid}">
          <label for="${field.oid}" class="control-label col-md-1" id="is_bayar1">
                  ${field.title}</label>
          <div class="col-md-2">
             ${structure:field.serialize()}
            <p id="error-${field.oid}" class="help-block" tal:condition="field.error"
               tal:repeat="error field.error.messages()">
               ${error}</p>
          </div>
        </div>
      </div>

      <div class="form-group"> 
        <div tal:define="field form['ap_nama']" id="item-${field.oid}">
          <label for="${field.oid}" class="control-label col-md-1" id="req-${field.oid}">
                  ${field.title}</label>
          <div class="col-md-3">
              ${structure:field.serialize()}
          </div>
          <p id="error-${field.oid}" class="help-block" tal:condition="field.error"
             tal:repeat="error field.error.messages()">
             ${error}</p>
        </div>
        <div tal:define="field form['ap_rekening']" id="item-${field.oid}">
          <label for="${field.oid}" class="control-label col-md-2" id="req-${field.oid}">
                  ${field.title}</label>
          <div class="col-md-3">
             ${structure:field.serialize()}
            <p id="error-${field.oid}" class="help-block" tal:condition="field.error"
               tal:repeat="error field.error.messages()">
               ${error}</p>
          </div>
        </div>
        <!--tanggal-------------------------------------------------------------------->
        <div tal:define="field form['is_uang']" id="item-${field.oid}">
          <label for="${field.oid}" class="control-label col-md-1" id="req-${field.oid}">
                  ${field.title}</label>
          <div class="col-md-2">
             ${structure:field.serialize()}
            <p id="error-${field.oid}" class="help-block" tal:condition="field.error"
               tal:repeat="error field.error.messages()">
               ${error}</p>
          </div>
        </div>
      </div>

      <div class="form-group"> 
        <div tal:define="field form['ap_npwp']" id="item-${field.oid}">
          <label for="${field.oid}" class="control-label col-md-1" id="req-${field.oid}">
                  ${field.title}</label>
          <div class="col-md-3">
             ${structure:field.serialize()}
            <p id="error-${field.oid}" class="help-block" tal:condition="field.error"
               tal:repeat="error field.error.messages()">
               ${error}</p>
          </div>
        </div>

        <div tal:define="field form['amount']" id="item-${field.oid}">
          <label for="${field.oid}" class="control-label col-md-2" id="req-${field.oid}">
                  ${field.title}</label>    
          <div class="col-md-3">
             ${structure:field.serialize()}
            <p id="error-${field.oid}" class="help-block" tal:condition="field.error"
               tal:repeat="error field.error.messages()">
               ${error}</p>
          </div>
        </div>
      </div><br>

      <!---ap_pemilik------------------------------------------------------------------->
        <div class="panel panel-default">
            <div class="panel-heading">
               <h5 class="panel-title">Kontrak</h5>
            </div>
        <br>

        <!---ap_kegiatankd------------------------------------------------------------------->
        <div class="form-group"> 
          <div tal:define="field form['ap_waktu']" id="item-${field.oid}">
            <label for="${field.oid}" class="control-label col-md-1" id="req-${field.oid}">
                    ${field.title}</label>
            <div class="col-md-3">
               ${structure:field.serialize()}
              <p id="error-${field.oid}" class="help-block" tal:condition="field.error"
                 tal:repeat="error field.error.messages()">
                 ${error}</p>
            </div>
          </div>
          <!---ap_uraian------------------------------------------------------------------->
          <div class="col-md-8"> 
            <div tal:define="field form['ap_uraian']" id="item-${field.oid}">
              <label for="${field.oid}" class="control-label col-md-1" id="req-${field.oid}">
                      ${field.title}</label>
              <div class="col-md-11">
                 ${structure:field.serialize()}
                <p id="error-${field.oid}" class="help-block" tal:condition="field.error"
                   tal:repeat="error field.error.messages()">
                   ${error}</p>
              </div>
            </div>
          </div>
        </div>

        <div class="form-group"> 
          <div tal:define="field form['ap_pemilik']" id="item-${field.oid}">
            <label for="${field.oid}" class="control-label col-md-1" id="req-${field.oid}">
                    ${field.title}</label>
            <div class="col-md-3">
               ${structure:field.serialize()}
              <p id="error-${field.oid}" class="help-block" tal:condition="field.error"
                 tal:repeat="error field.error.messages()">
                 ${error}</p>
            </div>
          </div>

          <!---ap_alamat------------------------------------------------------------------->
          <div class="col-md-5"> 
            <div tal:define="field form['ap_alamat']" id="item-${field.oid}">
            <label for="${field.oid}" class="control-label col-md-2" id="req-${field.oid}">
                    ${field.title}</label>
              <div class="col-md-12">
                 ${structure:field.serialize()}
                <p id="error-${field.oid}" class="help-block" tal:condition="field.error"
                   tal:repeat="error field.error.messages()">
                   ${error}</p>
              </div>
            </div>
          </div>

          <!---ap_bentuk------------------------------------------------------------------->
          <div class="col-md-3"> 
            <div tal:define="field form['ap_bentuk']" id="item-${field.oid}">
              <label for="${field.oid}" class="control-label col-md-5" id="req-${field.oid}">
                      ${field.title}</label>
              <div class="col-md-7">
                 ${structure:field.serialize()}
                <p id="error-${field.oid}" class="help-block" tal:condition="field.error"
                   tal:repeat="error field.error.messages()">
                   ${error}</p>
              </div>
            </div>
          </div>
      </div><hr>

        <!---ap_kontrak------------------------------------------------------------------->
        <div class="form-group"> 
          <div tal:define="field form['ap_kontrak']" id="item-${field.oid}">
            <label for="${field.oid}" class="control-label col-md-1" id="req-${field.oid}">
                    ${field.title}</label>
            <div class="col-md-3">
               ${structure:field.serialize()}
              <p id="error-${field.oid}" class="help-block" tal:condition="field.error"
                 tal:repeat="error field.error.messages()">
                 ${error}</p>
            </div>
          </div>

          <!---ap_tgl_kontrak------------------------------------------------------------------->
          <div class="col-md-4"> 
            <div tal:define="field form['ap_tgl_kontrak']" id="item-${field.oid}">
              <label for="${field.oid}" class="control-label col-md-4" id="req-${field.oid}">
                      ${field.title}</label>
              <div class="col-md-8">
                 ${structure:field.serialize()}
                <p id="error-${field.oid}" class="help-block" tal:condition="field.error"
                   tal:repeat="error field.error.messages()">
                   ${error}</p>
              </div>
            </div>
          </div>

          <!---ap_nilai------------------------------------------------------------------->
          <div class="col-md-4"> 
            <div tal:define="field form['ap_nilai']" id="item-${field.oid}">
              <label for="${field.oid}" class="control-label col-md-4" id="req-${field.oid}">
                      ${field.title}</label>
              <div class="col-md-8">
                 ${structure:field.serialize()}
                <p id="error-${field.oid}" class="help-block" tal:condition="field.error"
                   tal:repeat="error field.error.messages()">
                   ${error}</p>
              </div>
            </div>
          </div>
        </div>

        <!---ap_kwitansi_no------------------------------------------------------------------->
        <div class="form-group"> 
          <div tal:define="field form['ap_kwitansi_no']" id="item-${field.oid}">
            <label for="${field.oid}" class="control-label col-md-1" id="req-${field.oid}">
                    ${field.title}</label>
            <div class="col-md-3">
               ${structure:field.serialize()}
              <p id="error-${field.oid}" class="help-block" tal:condition="field.error"
                 tal:repeat="error field.error.messages()">
                 ${error}</p>
            </div>
          </div>

          <!---ap_kwitansi_tanggal------------------------------------------------------------------->
          <div class="col-md-4"> 
            <div tal:define="field form['ap_kwitansi_tgl']" id="item-${field.oid}">
              <label for="${field.oid}" class="control-label col-md-4" id="req-${field.oid}">
                      ${field.title}</label>
              <div class="col-md-8">
                 ${structure:field.serialize()}
                <p id="error-${field.oid}" class="help-block" tal:condition="field.error"
                   tal:repeat="error field.error.messages()">
                   ${error}</p>
              </div>
            </div>
          </div>

          <!---ap_kwitansi_nilai------------------------------------------------------------------->
          <div class="col-md-4"> 
            <div tal:define="field form['ap_kwitansi_nilai']" id="item-${field.oid}">
              <label for="${field.oid}" class="control-label col-md-4" id="req-${field.oid}">
                      ${field.title}</label>
              <div class="col-md-8">
                 ${structure:field.serialize()}
                <p id="error-${field.oid}" class="help-block" tal:condition="field.error"
                   tal:repeat="error field.error.messages()">
                   ${error}</p>
              </div>
            </div>
          </div>
        </div>   
        
        <div class="form-group"> 
          <!---ap_bap_no------------------------------------------------------------------->
          <div tal:define="field form['ap_bap_no']" id="item-${field.oid}">
            <label for="${field.oid}" class="control-label col-md-1" id="req-${field.oid}">
                    ${field.title}</label>
            <div class="col-md-3">
               ${structure:field.serialize()}
              <p id="error-${field.oid}" class="help-block" tal:condition="field.error"
                 tal:repeat="error field.error.messages()">
                 ${error}</p>
            </div>
          </div>
          <!---ap_bap_tanggal------------------------------------------------------------------->
          <div class="col-md-4"> 
            <div tal:define="field form['ap_bap_tgl']" id="item-${field.oid}">
              <label for="${field.oid}" class="control-label col-md-4" id="req-${field.oid}">
                      ${field.title}</label>
              <div class="col-md-8">
                 ${structure:field.serialize()}
                <p id="error-${field.oid}" class="help-block" tal:condition="field.error"
                   tal:repeat="error field.error.messages()">
                   ${error}</p>
              </div>
            </div>
          </div>
        </div><br> 
        </div> 
        
      <div class="form-group"> 
        <div class="col-md-3">
          <button type="submit" class="btn btn-primary" id="simpan" name="simpan" >Simpan</button>
          <!--button type="submit" class="btn btn-danger"  id="batal"  name="batal">Batal</button-->
          <button type="submit" class="btn btn-warning" id="tutup" name="tutup">Tutup</button>
        </div>
      </div>


      </form>
     </div>
    </div>

    <script>
      var mID;
      var oTable;
      var iPos;
      var ap_payment_id = $('#id').val();
      var oTableUrl = "/ap-payment/item/"+ap_payment_id+"/act/grid";
      var tb_array = [
          '<div class="btn-group pull-left">',
          '<!--button id="btn_delete" class="btn btn btn-danger"  type="button">Hapus</button-->',
          '<!--button id="btn_print"  class="btn btn btn-primary" type="button">Print</button-->',
          '<!--button id="btn_close"  class="btn btn-warning"     type="button">Tutup</button-->',
          '&nbsp;',
          '</div>',
      ];

      var tb = tb_array.join(' ');

      function formatNumber(n) {
         return n.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
      }
         
      $(document).ready(function () {
        oTable = $('#table1').dataTable({
            "sAjaxSource"    : oTableUrl,
            "bServerSide"    : true,
            "bProcessing"    : true,           
            "sDom"           : '<"toolbar">lfrtip',
            "bScrollCollapse": true,
            "bSort"          : true,
            "bInfo"          : false,
            "bFilter"        : true,
            "bAutoWidth"     : false,
            "bPaginate"      : true,
            "sPaginationType": "full_numbers",

            "lengthMenu": [
                [5, 10, 15, 25, 50, -1],
                [5, 10, 15, 25, 50, "All"]
            ],
            "aoColumnDefs": [{
                "bSearchable": false,
                "bVisible"   : false,
                "aTargets"   : [0,7,8,9,10,11]
            },{
                "bSearchable": true,
                "bSortable"  : false,
                "aTargets"   : [2]
            },{
                "bSearchable": false,
                "bSortable"  : false,
                "aTargets"   : [1,3,4,5,6]
            }            
            ],
            "aoColumns": [
                null, 
                {"sWidth": "60px"}, 
                null, 
                null, 
                {"sWidth": "100px", "sClass": "right"},
                {"sWidth": "100px", "sClass": "right"},
                {"sWidth": "100px", "sClass": "right"},
                null,
                null,
                null,
                null,
                
            ],
            "fnRowCallback": function (nRow, aData, iDisplayIndex) {
                $(nRow).on("click", function (event) {
                    if ($(this).hasClass('row_selected')) {
                        /* mID = '';
                        $(this).removeClass('row_selected'); */
                    } else {

                        var data = oTable.fnGetData(this);
                        mID = data[0];

                        $("#ap_payment_item_id").val(data[0]);
                        $("#no_urut1").val(data[1]);
                        $("#nama").val(data[2]);
                        $("#item_nm").val(data[3]+'-'+data[10]);   
                        $("#ppn").val(data[5]);
                        $("#pph").val(data[6]);
                        $("#vol_1").val(data[7]);
                        $("#vol_2").val(data[8]);
                        $("#harga").val(data[9]);
                        $("#kegiatan_item_id").val(data[11]);
                        $("#nilai").val(data[12]);

                        oTable.$('tr.row_selected').removeClass('row_selected');
                        $(this).addClass('row_selected');
                    }
                })
            },
        });

        $("div.toolbar").html(tb);

        $('#table1 tbody').on('click', 'tr', function () {
            if ($(this).hasClass('selected')) {
                $(this).removeClass('selected');
            } else {
                iPos = oTable.fnGetPosition(this);
                var aData = oTable.fnGetData(iPos);
                mID = aData[0];
                oTable.$('tr.selected').removeClass('selected');
                $(this).addClass('selected');
            }
        });
        /**********************************************************************/
        $('#btn_delete').click(function () {
            if (mID) {
              if (confirm('Yakin dihapus?')==true){
                $.ajax({
                type: "POST",
                url: "/ap-payment/item/"+$("#id").val()+"/"+mID+"/delete",
                success: function (html) {
                  if (html.success == true) {
                    $("#errors").html("<span class='glyphicon glyphicon-ok'></span> " + html.msg);
                    $('#no_urut1').val('');
                    $('#item_nm').val('');
                    $('#nama').val('');
                    $('#vol_1').val(1);
                    $('#vol_2').val(1);
                    $('#amount').val(0);
                    $('#harga').val(0);
                    $('#pph').val(0);
                    $('#ppn').val(0);

                    if(html.jml_total=="None"){
                      $('#jml_total').val(0);}
                    else{
                      $('#jml_total').val(formatNumber(html.jml_total));} 

                    oTable.fnReloadAjax(oTableUrl);
                  } else {
                    $("#errors").css('display', 'inline', 'important');
                    $("#errors").html("<span class='glyphicon glyphicon-remove'></span> " + html.msg);
                  }
                },
                beforeSend: function () {
                  $("#errors").css('display', 'inline', 'important');
                  $("#errors").html("<img src=\'${request.static_url('osipkd:static/images/ajax-loader.gif')}\' /> Loading...")
                }
                });
              } else {
                  alert('Silahkan pilih data yang akan di hapus');
              }
            }
        });
        
        $('#btn_print').click(function () {
            alert('not implemented');
        });

        $("#btn_close").click(function () {
            window.location = '/ap-payment';
            return false;
        });

        $("#no_urut").attr('readonly',true);
        $("#jml_total").attr('readonly',true);
        jml_total=$("#jml_total").val();
        $("#jml_total").val(formatNumber(jml_total));
        
        $('#no_urut1').attr('readonly',true);
        $('#item_nm').attr('readonly',true);
        $('#nama1').attr('readonly',true);
        $('#vol_1').attr('readonly',true);
        $('#vol_2').attr('readonly',true);
        $('#amount').attr('readonly',true);
        $('#harga').attr('readonly',true);
        $('#pph').attr('readonly',true);
        $('#ppn').attr('readonly',true);
        
        $('#nama').attr('readonly',true);
        $('#no_bku').attr('readonly',true);
        $('#tgl_bku').attr('readonly',true);
        $('#jenis').attr('readonly',true);
        $('#no_bast').attr('readonly',true);
        $('#tgl_bast').attr('readonly',true);
        $('#is_bayar').attr('readonly',true);
        $('#ap_nama').attr('readonly',true);
        $('#ap_rekening').attr('readonly',true);
        $('#ap_npwp').attr('readonly',true);
        $('#ap_waktu').attr('readonly',true);
        $('#ap_uraian').attr('readonly',true);
        $('#ap_pemilik').attr('readonly',true);
        $('#ap_alamat').attr('readonly',true);
        $('#ap_bentuk').attr('readonly',true);
        $('#ap_kontrak').attr('readonly',true);
        $('#ap_tgl_kontrak').attr('readonly',true);
        $('#ap_nilai').attr('readonly',true);
        $('#ap_kwitansi_no').attr('readonly',true);
        $('#ap_kwitansi_tgl').attr('readonly',true);
        $('#ap_kwitansi_nilai').attr('readonly',true);
        $('#ap_bap_no').attr('readonly',true);
        $('#ap_bap_tgl').attr('readonly',true);
     });
    </script>
  </div>
</html>